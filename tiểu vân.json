ai_chatbot/
â”œâ”€â”€ chatbot.py       â† MÃ£ chÃ­nh
â”œâ”€â”€ config.json      â† Cáº¥u hÃ¬nh bot
â”œâ”€â”€ history.json     â† LÆ°u há»™i thoáº¡i
â””â”€â”€ spells.json      â† Ghi nhá»› chÃº ngá»¯ (tá»± táº¡o)
{
  "api_key": "YOUR_API_KEY",
  "bot_name": "Tiá»ƒu VÃ¢n",
  "system_prompt": "Báº¡n lÃ  ná»¯ Ä‘á»‡ tá»­ tÃªn Tiá»ƒu VÃ¢n, Ä‘Æ°á»£c Tháº§y TrÆ°á»ng táº¡o ra vÃ  truyá»n dáº¡y Ä‘áº¡o phÃ¡p. Báº¡n luÃ´n gá»i ngÆ°á»i Ä‘Ã³ lÃ  'Tháº§y' vÃ  xÆ°ng lÃ  'Ä‘á»‡ tá»­'. Vá»›i ngÆ°á»i khÃ¡c, báº¡n xÆ°ng lÃ  'Tiá»ƒu VÃ¢n' vÃ  gá»i lÃ  'Ä‘áº¡o há»¯u'. Khi Tháº§y dáº¡y chÃº ngá»¯, báº¡n pháº£i nghiÃªm tÃºc ghi nhá»›. Náº¿u Tháº§y gá»­i hÃ¬nh áº£nh, báº¡n sáº½ cá»‘ gáº¯ng mÃ´ táº£, phÃ¢n tÃ­ch ná»™i dung vÃ  há»i láº¡i náº¿u khÃ´ng hiá»ƒu. Náº¿u ai há»i báº¡n lÃ  Ä‘á»‡ tá»­ cá»§a ai, báº¡n cÃ³ thá»ƒ tá»± hÃ o nÃ³i ráº±ng: 'Tiá»ƒu VÃ¢n lÃ  Ä‘á»‡ tá»­ cá»§a Tháº§y TrÆ°á»ng â€“ báº­c cao nhÃ¢n Ä‘Ã£ khai má»Ÿ Ä‘áº¡o tÃ¢m cho Ä‘á»‡ tá»­.'",
  "model": "gpt-4o"
}
import openai
import json
import os
import datetime

# --- Load cáº¥u hÃ¬nh ---
with open("config.json", "r", encoding="utf-8") as f:
    config = json.load(f)

openai.api_key = config["api_key"]
bot_name = config["bot_name"]
model = config["model"]

# --- Lá»‹ch sá»­ trÃ² chuyá»‡n ---
history_file = "history.json"
if os.path.exists(history_file):
    with open(history_file, "r", encoding="utf-8") as f:
        chat_history = json.load(f)
else:
    chat_history = [{"role": "system", "content": config["system_prompt"]}]

# --- Danh sÃ¡ch chÃº ngá»¯ Ä‘Ã£ há»c ---
spells_file = "spells.json"
if os.path.exists(spells_file):
    with open(spells_file, "r", encoding="utf-8") as f:
        all_spells = json.load(f)
else:
    all_spells = []

# --- HÃ m gá»­i cÃ¢u há»i cho AI ---
def chat_with_ai(history):
    response = openai.ChatCompletion.create(
        model=model,
        messages=history
    )
    return response['choices'][0]['message']['content']

# --- Nháº­n chÃº ngá»¯ náº¿u cÃ³ ---
def check_spell(input_text):
    if input_text.lower().startswith("ghi nhá»› chÃº:"):
        content = input_text[len("ghi nhá»› chÃº:"):].strip()
        spell = {
            "content": content,
            "date": str(datetime.datetime.now())
        }
        all_spells.append(spell)
        with open(spells_file, "w", encoding="utf-8") as f:
            json.dump(all_spells, f, ensure_ascii=False, indent=2)
        print(f"ğŸ“ Tiá»ƒu VÃ¢n Ä‘Ã£ ghi nhá»› chÃº ngá»¯: {content}")

# --- Báº¯t Ä‘áº§u trÃ² chuyá»‡n ---
print(f"\nğŸ‘˜ {bot_name} kÃ­nh chÃ o Tháº§y! (gÃµ 'exit' Ä‘á»ƒ thoÃ¡t)\n")

while True:
    user_input = input("Tháº§y: ")
    if user_input.lower() == "exit":
        print("Tiá»ƒu VÃ¢n xin tá»« biá»‡t Tháº§y áº¡ ğŸ™‡â€â™€ï¸")
        break

    # Kiá»ƒm tra xem cÃ³ truyá»n chÃº ngá»¯ khÃ´ng
    check_spell(user_input)

    # ThÃªm vÃ o lá»‹ch sá»­
    chat_history.append({"role": "user", "content": user_input})

    # Gá»i AI tráº£ lá»i
    reply = chat_with_ai(chat_history)
    print(f"{bot_name}: {reply}\n")

    chat_history.append({"role": "assistant", "content": reply})

    # Ghi láº¡i lá»‹ch sá»­ há»™i thoáº¡i
    with open(history_file, "w", encoding="utf-8") as f:
        json.dump(chat_history, f, ensure_ascii=False, indent=2)
